{% extends 'DdrGitkiBaseBundle:Wiki:base.html.twig' %}
{% block title %} - {{ path }} - Edit{% endblock %}
{% block heading %}
{% endblock %}
{% block content %}
    <div class="row editor">
        <div class="col-md-6">
            {{ form(form) }}
        </div>
        <div class="col-md-6">
            <div id="preview" class="markdown-html"></div>
        </div>
    </div>
{% endblock %}
{% block javascript %}
    {{ parent() }}
    <script type="text/javascript" src="{{ asset('js/markdown.js') }}"></script>
    <script type="text/javascript">

        function Editor(input, preview) {

            this.typeTimeout = undefined;

            this.update = function () {
                preview.html(function () {
                    return markdown.toHTML(input.val());
                });
            };

            input.editor = this;

            input.keypress(function () {
                clearTimeout(input.editor.typeTimeout);
                input.editor.typeTimeout = setTimeout(function () {
                    preview.html(function () {
                        return markdown.toHTML(input.val());
                    });
                    ;
                }, 200);
            });

            this.update();
        }
        new Editor($("#form_content"), $("#preview"));
    </script>
    <script type="text/javascript">
        var holdLockUrl = "{{ path('ddr_gitki_wiki_file', {'path': path, 'action': 'holdlock'}) }}";
        var timeOut = undefined;
        function holdLock() {
            $.get(holdLockUrl)
                    .done(function (data) {
                        window.setTimeout(holdLock, 10000);
                    })
                    .fail(function (data) {
                        console.error(data);
                        alert("We are sorry. Holding the page lock failed (saving won't work anymore), copy your data to the clipboard, go back and try to reedit the page.")
                    });
        }
        holdLock();
    </script>
{% endblock %}