parameters:
#    ddr_gitki_base.example.class: Dontdrinkandroot\Gitki\BaseBundle\Example

services:

    ddr.gitki.repository.user:
        class:           Dontdrinkandroot\Gitki\BaseBundle\DoctrineUserRepository
        factory_service: doctrine.orm.entity_manager
        factory_method:  getRepository
        arguments:
            - Dontdrinkandroot\Gitki\BaseBundle\Entity\User

    ddr.gitki.twig.gitki_extension:
        class: Dontdrinkandroot\Gitki\BaseBundle\Twig\GitkiExtension
        tags:
            - { name: twig.extension }

    ddr.gitki.security.response_handler.github:
        class: Dontdrinkandroot\Gitki\BaseBundle\Security\GitHubResponseHandler

    ddr.gitki.security.response_handler.google:
        class: Dontdrinkandroot\Gitki\BaseBundle\Security\GoogleResponseHandler

    ddr.gitki.repository.git:
        class: Dontdrinkandroot\Gitki\BaseBundle\Repository\GitRepository
        arguments: [%ddr_gitki_base.repository_path%]

    ddr.gitki.service.user:
        #class: Dontdrinkandroot\Gitki\BaseBundle\Service\VolatileUserService
        #arguments: [%ddr_gitki_base.users%]
       class: Dontdrinkandroot\Gitki\BaseBundle\Service\DoctrineUserService
       arguments: [@ddr.gitki.repository.user, @security.encoder_factory, @security.secure_random]

    ddr.gitki.service.markdown:
        class: Dontdrinkandroot\Gitki\BaseBundle\Service\Markdown\RepositoryAwareMarkdownService
        arguments: [@ddr.gitki.repository.git]

    ddr.gitki.service.wiki:
        class: Dontdrinkandroot\Gitki\BaseBundle\Service\WikiService
        arguments: [@ddr.gitki.repository.git, @ddr.gitki.service.markdown, @event_dispatcher]

    ddr.gitki.security.user_provider:
        class: Dontdrinkandroot\Gitki\BaseBundle\Security\UserProvider
        arguments: [@ddr.gitki.service.user]
        calls:
            - [registerHandler, [@ddr.gitki.security.response_handler.github]]
            - [registerHandler, [@ddr.gitki.security.response_handler.google]]

    ddr.gitki.service.action_handler.directory:
        class: Dontdrinkandroot\Gitki\BaseBundle\Service\ActionHandler\Directory\DirectoryActionHandlerService

    ddr.gitki.service.action_handler.file:
        class: Dontdrinkandroot\Gitki\BaseBundle\Service\ActionHandler\File\FileActionHandlerService

    # DIRECTORY HANDLERS

    ddr.gitki.service.action_handler.directory.list:
        class: Dontdrinkandroot\Gitki\BaseBundle\Service\ActionHandler\Directory\ListDirectoryActionHandler
        calls:
            - [ setContainer,[ @service_container ] ]
        tags:
            -  { name: ddr.gitki.action_handler.directory }
            -  { name: ddr.gitki.action_handler.directory, action: list }

    ddr.gitki.service.action_handler.directory.index:
        class: Dontdrinkandroot\Gitki\BaseBundle\Service\ActionHandler\Directory\DirectoryIndexActionHandler
        calls:
            - [ setContainer,[ @service_container ] ]
        tags:
            -  { name: ddr.gitki.action_handler.directory, action: index }

    ddr.gitki.service.action_handler.directory.add_folder:
        class: Dontdrinkandroot\Gitki\BaseBundle\Service\ActionHandler\Directory\AddFolderDirectoryActionHandler
        calls:
            - [ setContainer,[ @service_container ] ]
        tags:
            -  { name: ddr.gitki.action_handler.directory, action: addfolder }

    ddr.gitki.service.action_handler.directory.delete:
        class: Dontdrinkandroot\Gitki\BaseBundle\Service\ActionHandler\Directory\DeleteDirectoryActionHandler
        calls:
            - [ setContainer,[ @service_container ] ]
        tags:
            -  { name: ddr.gitki.action_handler.directory, action: delete }

    ddr.gitki.service.action_handler.directory.upload_file:
        class: Dontdrinkandroot\Gitki\BaseBundle\Service\ActionHandler\Directory\UploadFileActionHandler
        calls:
            - [ setContainer,[ @service_container ] ]
        tags:
            -  { name: ddr.gitki.action_handler.directory, action: upload }

    ddr.gitki.service.action_handler.directory.add_page:
        class: Dontdrinkandroot\Gitki\BaseBundle\Service\ActionHandler\Directory\AddPageActionHandler
        calls:
            - [ setContainer,[ @service_container ] ]
        tags:
            -  { name: ddr.gitki.action_handler.directory, action: addpage }

    # FILE HANDLERS

    ddr.gitki.service.action_handler.file.serve:
        class: Dontdrinkandroot\Gitki\BaseBundle\Service\ActionHandler\File\ServeFileActionHandler
        calls:
            - [ setContainer,[ @service_container ] ]
        tags:
            -  { name: ddr.gitki.action_handler.file }

    ddr.gitki.service.action_handler.file.delete:
        class: Dontdrinkandroot\Gitki\BaseBundle\Service\ActionHandler\File\DeleteFileActionHandler
        calls:
            - [ setContainer,[ @service_container ] ]
        tags:
            -  { name: ddr.gitki.action_handler.file, action: delete }

    ddr.gitki.service.action_handler.file.rename:
        class: Dontdrinkandroot\Gitki\BaseBundle\Service\ActionHandler\File\RenameFileActionHandler
        calls:
            - [ setContainer,[ @service_container ] ]
        tags:
            -  { name: ddr.gitki.action_handler.file, action: rename }

    ddr.gitki.service.action_handler.file.history:
        class: Dontdrinkandroot\Gitki\BaseBundle\Service\ActionHandler\File\FileHistoryActionHandler
        calls:
            - [ setContainer,[ @service_container ] ]
        tags:
            -  { name: ddr.gitki.action_handler.file, action: history }

    ddr.gitki.service.action_handler.file.hold_lock:
        class: Dontdrinkandroot\Gitki\BaseBundle\Service\ActionHandler\File\HoldLockActionHandler
        calls:
            - [ setContainer,[ @service_container ] ]
        tags:
            -  { name: ddr.gitki.action_handler.file, action: holdlock }

    ddr.gitki.service.action_handler.file.serve_markdown:
        class: Dontdrinkandroot\Gitki\BaseBundle\Service\ActionHandler\File\ServeMarkdownFileActionHandler
        calls:
            - [ setContainer,[ @service_container ] ]
        tags:
            -  { name: ddr.gitki.action_handler.file, extension: md }

    ddr.gitki.service.action_handler.file.edit_markdown:
        class: Dontdrinkandroot\Gitki\BaseBundle\Service\ActionHandler\File\EditMarkdownFileActionHandler
        calls:
            - [ setContainer,[ @service_container ] ]
        tags:
            -  { name: ddr.gitki.action_handler.file, action: edit, extension: md }

    ddr.gitki.service.action_handler.file.preview_markdown:
        class: Dontdrinkandroot\Gitki\BaseBundle\Service\ActionHandler\File\PreviewMarkdownFileActionHandler
        calls:
            - [ setContainer,[ @service_container ] ]
        tags:
            -  { name: ddr.gitki.action_handler.file, action: preview, extension: md }
